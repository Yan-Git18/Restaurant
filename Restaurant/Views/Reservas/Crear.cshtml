@model Restaurant.ViewModels.ReservaFormViewModel
@{
    ViewData["Title"] = "Nueva Reserva";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container mt-4">
    <h3 class="fw-bold mb-3">📝 Crear Reserva</h3>
    <p class="text-muted">Seleccione un cliente y complete los datos de la reserva.</p>

    <form asp-action="Crear" method="post" class="row g-3">
        @Html.AntiForgeryToken()

        <!-- Cliente -->
        <div class="col-md-12">
            <label for="ClienteId" class="form-label">Seleccionar Cliente</label>
            <select asp-for="ClienteId" asp-items="ViewBag.Clientes" class="form-select" id="ClienteId">
                <option value="">Seleccione un cliente...</option>
            </select>
            <span asp-validation-for="ClienteId" class="text-danger"></span>
        </div>

        <!-- Nombre -->
        <div class="col-md-6">
            <label asp-for="Nombre" class="form-label">Nombre Completo</label>
            <input asp-for="Nombre" class="form-control" id="Nombre" readonly />
        </div>

        <!-- Teléfono -->
        <div class="col-md-6">
            <label asp-for="Telefono" class="form-label">Teléfono</label>
            <input asp-for="Telefono" class="form-control" id="Telefono" readonly />
        </div>

        <!-- Correo -->
        <div class="col-md-12">
            <label asp-for="Email" class="form-label">Correo Electrónico</label>
            <input asp-for="Email" class="form-control" id="Email" readonly />
        </div>

        <!-- Fecha -->
        <div class="col-md-6">
            <label asp-for="Fecha" class="form-label">Fecha</label>
            <input asp-for="Fecha" type="date" class="form-control" min="@DateTime.Now.ToString("yyyy-MM-dd")" />
        </div>

        <!-- Hora -->
        <div class="col-md-6">
            <label asp-for="Hora" class="form-label">Hora</label>
            <select asp-for="Hora" class="form-select">
                <option value="">Selecciona una hora</option>
                @for (int h = 12; h <= 23; h++)
                {
                    <option value="@($"{h:00}:00")">@($"{h:00}:00")</option>
                    <option value="@($"{h:00}:30")">@($"{h:00}:30")</option>
                }
            </select>
        </div>

        <!-- Número de Personas -->
        <div class="col-md-6">
            <label asp-for="Personas" class="form-label">Número de Personas</label>
            <select asp-for="Personas" class="form-select">
                <option value="">Selecciona</option>
                @for (int i = 1; i <= 7; i++)
                {
                    <option value="@i">@i persona@(i > 1 ? "s" : "")</option>
                }
                <option value="8+">8 o más</option>
            </select>
        </div>

        <!-- Ocasión -->
        <div class="col-md-6">
            <label asp-for="Ocasion" class="form-label">Ocasión Especial</label>
            <select asp-for="Ocasion" class="form-select">
                <option value="">Selecciona</option>
                <option value="Cumpleaños">Cumpleaños</option>
                <option value="Aniversario">Aniversario</option>
                <option value="Negocios">Negocios</option>
                <option value="Otro">Otro</option>
            </select>
        </div>

        <!-- Comentarios -->
        <div class="col-md-12">
            <label asp-for="Comentarios" class="form-label">Comentarios Especiales</label>
            <textarea asp-for="Comentarios" class="form-control" rows="3"></textarea>
        </div>

        <div class="col-12 text-end">
            <a asp-controller="Reservas" asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
            <button type="submit" class="btn btn-primary">Guardar Reserva</button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const clienteSelect = document.getElementById('ClienteId');
            const nombreInput = document.getElementById('Nombre');
            const telefonoInput = document.getElementById('Telefono');
            const correoInput = document.getElementById('Email');

            clienteSelect.addEventListener('change', function () {
                const id = this.value;
                if (id) {
                    fetch(`/Reservas/ObtenerCliente?id=${id}`)
                        .then(res => res.json())
                        .then(data => {
                            nombreInput.value = data.nombre || "";
                            telefonoInput.value = data.telefono || "";
                            correoInput.value = data.correo || "";
                        });
                } else {
                    nombreInput.value = "";
                    telefonoInput.value = "";
                    correoInput.value = "";
                }
            });
        });
    </script>
}
